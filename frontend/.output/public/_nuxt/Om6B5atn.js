import{k as b,c as p,a as S,s as k,d as I,t as w,y as E,o as v,g as A,r as d,l as N}from"./BG0I7BMR.js";const V={class:"flex flex-col"},_=["for"],O={key:0,class:"text-red-500"},T=["type","id","name","autocomplete","value"],P={key:0,class:"h-font-size-12 text-red-500 text-left mt-1"},j={key:1,class:"h-font-size-10 text-left h-color-lunar-green mt-1"},x=b({__name:"FormInput",props:{id:{},name:{},label:{},type:{},modelValue:{},error:{type:Boolean},errorMessage:{},helpText:{},required:{type:Boolean},autocomplete:{}},emits:["update:modelValue","blur"],setup(m,{emit:l}){const u=l,i=e=>{const c=e.target;u("update:modelValue",c.value)};return(e,c)=>(v(),p("div",V,[S("label",{for:e.id,class:"text-left h-font-size-14 mb-1"},[I(w(e.label)+" ",1),e.required?(v(),p("span",O,"*")):k("",!0)],8,_),S("input",{type:e.type,id:e.id,name:e.name,autocomplete:e.autocomplete,class:E(["h-bg-alto h-font-weight-400 h-font-size-14 rounded-md p-1 inset-shadow-sm",{"border border-red-500":e.error}]),value:e.modelValue,onInput:i,onBlur:c[0]||(c[0]=g=>e.$emit("blur"))},null,42,T),e.errorMessage?(v(),p("div",P,w(e.errorMessage),1)):k("",!0),e.helpText?(v(),p("div",j,w(e.helpText),1)):k("",!0)]))}}),M=()=>{const m=N(),{locale:l,t:u}=A(),i=d(!1),e=d(null),c=d({id:"",email:"",first_name:"",last_name:"",county:"",locality:"",street:"",street_number:"",phone:"",picture:""}),g=d(!1),s=t=>{t.access_token&&(localStorage.setItem("token",t.access_token),localStorage.setItem("user",JSON.stringify(t.user)),c.value=t.user,g.value=!0)},o=t=>{console.error("Authentication error:",t);const r=t.message||"An error occurred during authentication";return e.value={message:r},e.value};return{user:c,isAuthenticated:g,checkAuth:()=>{const t=localStorage.getItem("token"),r=localStorage.getItem("user");if(t&&r)return g.value=!0,c.value=JSON.parse(r),!0;g.value=!1;const a=l.value==="en"?"/en/login":"/login";return m.push(a),!1},loadUser:async()=>{try{const t=localStorage.getItem("token");if(!t)return;const r=await fetch("http://localhost:4000/users/profile",{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error("Failed to load user data");const a=await r.json();c.value=a,localStorage.setItem("user",JSON.stringify(a))}catch(t){console.error("Error loading user data:",t)}},logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user");const t=l.value==="en"?"/en/login":"/login";m.push(t)},login:async(t,r)=>{try{i.value=!0,e.value=null;const a=await fetch("http://localhost:4000/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),h=await a.json();if(!a.ok)throw new Error(h.message||"Login failed");if(!h.access_token)throw new Error("No access token received");return s(h),{success:!0,data:h}}catch(a){return{success:!1,error:o(a)}}finally{i.value=!1}},register:async t=>{try{i.value=!0,e.value=null;const r=await fetch("http://localhost:4000/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw a.message==="Email already exists"?(e.value={message:u("email-already-exists"),field:"email"},e.value):a.message==="Phone number already exists"?(e.value={message:u("phone-already-exists"),field:"phone"},e.value):new Error(a.message||"Registration failed");return s(a),m.push(l.value==="en"?"/en/auth/email-verification":"/auth/email-verification"),a}catch(r){return r instanceof Error?o(r):r}finally{i.value=!1}},googleAuth:()=>{window.location.href="http://localhost:4000/auth/google"},isLoading:i,error:e,updateProfile:async t=>{try{i.value=!0,e.value=null;const r=localStorage.getItem("token");if(!r)throw new Error("No authentication token found");const a=await fetch("http://localhost:4000/users/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)}),h=await a.json();if(!a.ok)throw new Error(h.message||"Profile update failed");const y={...c.value,...h};return c.value=y,localStorage.setItem("user",JSON.stringify(y)),{success:!0,data:y}}catch(r){return{success:!1,error:o(r)}}finally{i.value=!1}}}},U=m=>{const l=d({}),u=d({}),i=d(!1),e=(s,o)=>{const f=m[s];if(!f)return!0;for(const n of f)if(n.required&&!(o!=null&&o.trim())||o&&n.minLength&&o.length<n.minLength||o&&n.maxLength&&o.length>n.maxLength||o&&n.pattern&&!n.pattern.test(o)||o&&n.custom&&!n.custom(o))return l.value[s]=!0,u.value[s]=n.message,!1;return l.value[s]=!1,u.value[s]="",!0};return{formErrors:l,errorMessages:u,isFormValid:i,validateField:e,validateForm:s=>{let o=!0;return Object.keys(m).forEach(f=>{e(f,s[f])||(o=!1)}),i.value=o,o},resetValidation:()=>{l.value={},u.value={},i.value=!1}}};export{x as _,U as a,M as u};
